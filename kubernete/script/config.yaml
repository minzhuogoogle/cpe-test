periodics:
- interval: 24h
  agent: kubernetes
  name: elastifile-deployer
  spec:
    containers:
    - image: gcr.io/cpe-performance-storage/elastifile:v20181012-f8c6bc0
      tty: true
      stdin: true
      command:
      - sh
      - -c
      - 'curl -OL https://raw.githubusercontent.com/minzhuogoogle/cpe-test/master/scripts/shell/elastifile_deploy.sh; chmod 777 elastifile_deploy.sh; ./elastifile_deploy.sh'


- interval: 6h
  agent: kubernetes
  name: elastifile-io-test
  spec:
    containers:
    - image: gcr.io/cpe-performance-storage/elastifile:v20181012-f8c6bc0
      tty: true
      stdin: true
      command:
      - sh
      - -c
      - 'curl -OL https://raw.githubusercontent.com/minzhuogoogle/cpe-test/master/scripts/shell/pod_runfio.sh; chmod 777 pod_runfio.sh; ./pod_runfio.sh'
      volumeMounts:
        # name must match the volume name below
        - name: mynfs
          mountPath: "/mnt/elastifile"
      volumes:
      - name: mynfs
        persistentVolumeClaim:
          claimName: elastifile-data-1


postsubmits:
  minzhuogoogle/storage-performance:
  - name: elastifile-perf-regression 
    agent: kubernetes
    branches:
    - master
    max_concurrency: 1
    spec:
      containers:
      - image: gcr.io/cpe-performance-storage/storage-test:v20181008-f2a92fbd8
        tty: true
        stdin: true
        command:
        - sh
        - -c
        - 'mkdir -p /mnt/qtest; cd /mnt/qtest; /workspace/storage-performance/quickfio.test.sh'
        volumeMounts:
        # name must match the volume name below
        - name: mynfs
          mountPath: "/mnt"
      volumes:
      - name: mynfs
        persistentVolumeClaim:
          claimName: elastifile-vol-1

